# Session 36 RPi - Hardware Gait Tuning (2026-01-02)

## Summary

Major breakthrough session: achieved smooth, controlled walking through iterative hardware parameter tuning.

## Key Accomplishments

1. **Fixed servo acceleration bug**
   - Changed GAIT_ACC from 0 (slowest) to 150 (fastest/instant)
   - This was critical for backlash mitigation

2. **Iteratively tuned gait parameters**
   - Started with original 40° thigh, 50° calf (too aggressive)
   - Progressively reduced stride length
   - Final: 7.5° thigh, 30° calf, 0.5 Hz

3. **Validated on multiple surfaces**
   - Shaggy carpet: works
   - Hardwood floor: works

## Parameter Evolution

| Iteration | Thigh Range | Calf Range | Frequency | Result |
|-----------|-------------|------------|-----------|--------|
| Start | 40° | 50° | 0.7 Hz | Uncontrolled lunge |
| 1 | 10° | 50° | 0.7 Hz | Better, still lunging |
| 2 | 5° | 50° | 0.7 Hz | Improved |
| 3 | 2.5° | 50° | 0.7 Hz | Good |
| 4 | 2.5° | 25° | 0.7 Hz | REGRESSION - feet don't lift |
| 5 | 2.5° | 50° | 0.5 Hz | Better stability |
| 6 | 0.625° | 50° | 0.5 Hz | Thighs barely moving |
| 7 | 15° | 30° | 0.5 Hz | Good balance |
| **Final** | **7.5°** | **30°** | **0.5 Hz** | **Smooth walking** |

## Final Working Parameters

```cpp
const float GAIT_FREQUENCY = 0.5f;
const float BASE_STANCE_THIGH = -38.15f;  // 7.5° range
const float BASE_SWING_THIGH  = -30.65f;
const float BASE_STANCE_CALF  = 50.0f;    // 30° range
const float BASE_SWING_CALF   = 80.0f;
const int GAIT_ACC = 150;
```

## Key Insights

1. **Original sim parameters (40° thigh) are ~5x too aggressive for hardware**
2. **Calf range has minimum threshold (~30°)** - below this, backlash absorbs motion
3. **Thigh and calf must be balanced** - can't just reduce one
4. **0.5 Hz more stable than 0.7 Hz**
5. **ACC=150 is critical** for crossing backlash zone quickly

## Implications for RL

- RL policies should produce SMALL joint motions
- Target: thigh <0.13 rad, calf ~0.52 rad
- Penalize large amplitude motions
- Consider 0.5 Hz gait frequency

## Files Modified

- `firmware/scripted_gait_test_1/scripted_gait_test_1.ino`
- `docs/memory/OBSERVATIONS.md`
- `docs/memory/NEXT_STEPS.md`

## Next Steps

1. RL agent should incorporate hardware-validated parameters as constraints
2. Consider reference motion tracking using these trajectories
3. Add joint amplitude penalties to encourage small motions
